<?xml version="1.0" encoding="UTF-8"?>
<!--
   - Kuali Coeus, a comprehensive research administration system for higher education.
   - 
   - Copyright 2005-2015 Kuali, Inc.
   - 
   - This program is free software: you can redistribute it and/or modify
   - it under the terms of the GNU Affero General Public License as
   - published by the Free Software Foundation, either version 3 of the
   - License, or (at your option) any later version.
   - 
   - This program is distributed in the hope that it will be useful,
   - but WITHOUT ANY WARRANTY; without even the implied warranty of
   - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   - GNU Affero General Public License for more details.
   - 
   - You should have received a copy of the GNU Affero General Public License
   - along with this program.  If not, see <http://www.gnu.org/licenses/>.
 -->
<data xmlns="ns:workflow" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="ns:workflow resource:WorkflowData">
  <documentTypes xmlns="ns:workflow/DocumentType" xsi:schemaLocation="ns:workflow/DocumentType resource:DocumentType">
  <documentType>
    <name>ProposalDevelopmentDocument</name>
    <parent>KC</parent>
    <description>Create an Awesome Development Proposal</description>
    <label>Proposal Development Document</label>
    <postProcessorName>org.kuali.coeus.sys.framework.workflow.KcPostProcessor</postProcessorName>
    <superUserGroupName namespace="KC-WKFLW">OSP Superuser</superUserGroupName>
    <defaultExceptionGroupName namespace="KC-WKFLW">ProposalAdmin</defaultExceptionGroupName>
    <docHandler>${kuali.docHandler.url.prefix}/kc-pd-krad/proposalDevelopment?methodToCall=docHandler</docHandler>
    <helpDefinitionURL>default.htm?turl=Documents/proposaldevelopment.htm</helpDefinitionURL>
    <authorizer>org.kuali.coeus.propdev.impl.auth.ProposalDevelopmentWorkflowDocumentAuthorizer</authorizer>
    <active>true</active>
      <policies>
        <policy>
          <name>LOOK_FUTURE</name>
          <value>true</value>
        </policy>
        <policy>
          <name>INITIATOR_MUST_ROUTE</name>
          <value>false</value>
        </policy>
        <policy>
          <name>INITIATOR_MUST_CANCEL</name>
          <value>false</value>
        </policy>
        <policy>
          <name>DOCUMENT_STATUS_POLICY</name>
          <stringValue>app</stringValue>
        </policy>
        <policy>
          <name>DOC_SEARCH_TARGET</name>
          <stringValue>_parent</stringValue>
        </policy>
      </policies>
    <attributes>
    <attribute>
      <name>CopyCustomActionListAttribute</name>
    </attribute>
    <attribute>
      <name>AggregatorSearchAttribute</name>
    </attribute>
    <attribute>
      <name>BudgetCreatorSearchAttribute</name>
    </attribute>
    <attribute>
      <name>NarrativeWriterSearchAttribute</name>
    </attribute>
    <attribute>
      <name>ViewerSearchAttribute</name>
    </attribute>
    </attributes>
    <routingVersion>2</routingVersion>
    <routePaths>
    <routePath>
      <start name="Initiated" nextNode="isHierarchyChild" />
      <split name="isHierarchyChild">
      <branch name="False">
	        <!-- UH Routing -->
			<requests name="ProposalPersons" nextNode="PreApprover" />
			<requests name="PreApprover" nextNode="Initial_FA" />
			<requests name="Initial_FA" nextNode="Chair" />
			<requests name="Chair" nextNode="Dean_VC" />
			<requests name="Dean_VC" nextNode="Final_Unit_Approval" />
			<requests name="Final_Unit_Approval" nextNode="PeopleFlows" />
			<requests name="PeopleFlows" nextNode="UH_Central_Final_Approval" />
			<requests name="UH_Central_Final_Approval" nextNode="Join" />		
      </branch>
      <branch name="True">
        <requests name="WaitForHierarchyDisposition" nextNode="Join" />
      </branch>
      <join name="Join" />
      </split>
    </routePath>
    </routePaths>
    <routeNodes>
    <start name="Initiated">
      <activationType>P</activationType>
      <mandatoryRoute>false</mandatoryRoute>
      <finalApproval>false</finalApproval>
    </start>
    <split name="isHierarchyChild">
      <type>org.kuali.coeus.sys.framework.workflow.SimpleBooleanSplitNode</type>
    </split>
    <role name="ProposalPersons">
      <qualifierResolver>ProposalPersons-XPathQualifierResolver</qualifierResolver>
      <activationType>P</activationType>
      <finalApproval>false</finalApproval>
    </role>
    <requests name="PeopleFlows">
      <activationType>R</activationType>
      <rulesEngine executorClass="org.kuali.coeus.propdev.impl.core.ProposalDevelopmentRulesEngineExecutorImpl" />
    </requests>
 	<requests name="PreApprover">
		<activationType>P</activationType>
		<finalApproval>false</finalApproval>
		<ruleSelector>Named</ruleSelector>
		<ruleName>PreApproverRoutingRule</ruleName>
	</requests>
	
	<requests name="Initial_FA">
		<activationType>P</activationType>
		<finalApproval>false</finalApproval>
		<ruleSelector>Named</ruleSelector>
		<ruleName>InitialFARoutingRule</ruleName>
	</requests>
	
	<requests name="Chair">
		<activationType>P</activationType>
		<finalApproval>false</finalApproval>
		<ruleSelector>Named</ruleSelector>
		<ruleName>ChairRoutingRule</ruleName>
	</requests>
	
	<requests name="Dean_VC">
		<activationType>P</activationType>
		<finalApproval>false</finalApproval>
		<ruleSelector>Named</ruleSelector>
		<ruleName>DeanVCRoutingRule</ruleName>
	</requests>
	
	<requests name="Final_Unit_Approval">
		<activationType>P</activationType>
		<finalApproval>false</finalApproval>
		<ruleSelector>Named</ruleSelector>
		<ruleName>FinalUnitApprovalRoutingRule</ruleName>
	</requests>
    <role name="UH_Central_Final_Approval">
		<qualifierResolver>UH_Final_Approval-XPathQualifierResolver</qualifierResolver>
        <activationType>P</activationType>
		<finalApproval>false</finalApproval>
	</role>
    <join name="Join" />
    <requests name="WaitForHierarchyDisposition">
      <activationType>S</activationType>
      <ruleTemplate>HierarchyParentDispositionApproval</ruleTemplate>
      <mandatoryRoute>true</mandatoryRoute>
      <ignorePrevious>true</ignorePrevious>
      <finalApproval>false</finalApproval>
    </requests>
    </routeNodes>
  </documentType>
  </documentTypes>
  <ruleTemplates xmlns="ns:workflow/RuleTemplate" xsi:schemaLocation="ns:workflow/RuleTemplate resource:RuleTemplate">
    <ruleTemplate allowOverwrite="true">
      <name>DepartmentRouting</name>
      <description>Department Routing</description>
    </ruleTemplate>

    <ruleTemplate allowOverwrite="true">
      <name>CollegeRouting</name>
      <description>College Routing</description>
    </ruleTemplate>
    <ruleTemplate allowOverwrite="true">
		<name>HierarchyParentDispositionApproval</name>
		<description>Approval rule from the hierarchy parent to hierarchy children.</description>
	</ruleTemplate>
  </ruleTemplates>
  <rules xmlns="ns:workflow/Rule" xsi:schemaLocation="ns:workflow/Rule resource:Rule">
        <rule>
  			<name>PreApproverRoutingRule</name>
			<documentType>ProposalDevelopmentDocument</documentType>
			<ruleTemplate>PreApproverRoutingTemplate</ruleTemplate>
			<description>PreApprover Routing</description>
			<responsibilities>
				<responsibility>
					<roleName attributeClassName="edu.hawaii.proposaldevelopment.document.workflow.UhUnitAdministratorRoleAttribute">REQ=Y!Initial Approvers!JABSOM:GDO:910|UHMC:Personnel Approver:912|KU:GAO:918</roleName> <!-- [Options]...:[Role;AdminCode]... -->
					<approvePolicy>F</approvePolicy><!-- A[ll] F[irst] -->
					<actionRequested>A</actionRequested><!-- F[YI] A[PPROVE] [A]K[NOWLADGE] -->
				</responsibility>
			</responsibilities>
		</rule>	
	
		<rule>
			<name>InitialFARoutingRule</name>
			<documentType>ProposalDevelopmentDocument</documentType>
			<ruleTemplate>InitialFARoutingTemplate</ruleTemplate>
			<description>Initial FA Routing</description>
			<responsibilities>
				<responsibility>
					<roleName attributeClassName="edu.hawaii.proposaldevelopment.document.workflow.UhUnitAdministratorRoleAttribute">REQ=Y!FA Approvers!JABSOM,EXT:skip:0|DEFAULT:FA:913</roleName>
					<approvePolicy>F</approvePolicy><!-- A[ll] F[irst] -->
					<actionRequested>A</actionRequested><!-- F[YI] A[PPROVE] [A]K[NOWLADGE] -->
				</responsibility>
			</responsibilities>
		</rule>
		
		<rule>
			<name>ChairRoutingRule</name>
			<documentType>ProposalDevelopmentDocument</documentType>
			<ruleTemplate>ChairRoutingTemplate</ruleTemplate>
			<description>Chair Routing</description>
			<responsibilities>
				<responsibility>
					<roleName attributeClassName="edu.hawaii.proposaldevelopment.document.workflow.UhUnitAdministratorRoleAttribute">REQ=Y!Chair Approval!JABSOM,HILO,UHMC,WO,UHMANOA:Chair:914</roleName>
					<approvePolicy>F</approvePolicy>
					<actionRequested>A</actionRequested>
				</responsibility>
			</responsibilities>
		</rule>
		
		<rule>
			<name>DeanVCRoutingRule</name>
			<documentType>ProposalDevelopmentDocument</documentType>
			<ruleTemplate>DeanVCRoutingTemplate</ruleTemplate>
			<description>Dean/Vice Chancellor Routing</description>
			<responsibilities>
				<responsibility>
					<roleName attributeClassName="edu.hawaii.proposaldevelopment.document.workflow.UhUnitAdministratorRoleAttribute">REQ=Y!Dean/Vice Chancellor!UHMC:Vice Chancellor:916|EXT,WO:skip:0|DEFAULT:Dean:915</roleName>
					<approvePolicy>F</approvePolicy>
					<actionRequested>A</actionRequested>
				</responsibility>
			</responsibilities>
		</rule>
		
		<!-- Mike is looking into moving JABSOM FA with the standard FA level -->
		<rule>
			<name>FinalUnitApprovalRoutingRule</name>
			<documentType>ProposalDevelopmentDocument</documentType>
			<ruleTemplate>FinalUnitApprovalRoutingTemplate</ruleTemplate>
			<description>Final Unit Approval Routing</description>
			<responsibilities>
				<responsibility>
				<!-- REQ=Y!Final Unit Approval!JABSOM:FA:913|WO:Chancellor/Vice Chancellor:916,917|HILO:Chancellor:917|UHMC:Chancellor:917|CC:Chancellor:917|DEFAULT:skip:0 -->
					<roleName attributeClassName="edu.hawaii.proposaldevelopment.document.workflow.UhUnitAdministratorRoleAttribute">REQ=Y!Final Approval!JABSOM:FA:913|WO:Chancellor/Vice Chancellor:916,917|DEFAULT:Chancellor:917|EXT,UHMANOA:skip:0</roleName>
					<approvePolicy>F</approvePolicy>
					<actionRequested>A</actionRequested>
				</responsibility>
			</responsibilities>
		</rule>
  </rules>
  
	<ruleAttributes xmlns="ns:workflow/RuleAttribute" xsi:schemaLocation="ns:workflow/RuleAttribute resource:RuleAttribute">
		<ruleAttribute>
			<name>CopyCustomActionListAttribute</name>
			<className>
				org.kuali.coeus.sys.impl.workflow.CopyCustomActionListAttribute
			</className>
			<label>Copy Action List Attribute</label>
			<description>Copy Action List Attribute</description>
			<type>ActionListAttribute</type>
			<serviceNamespace>KC</serviceNamespace>
		</ruleAttribute>

		<ruleAttribute>
			<name>AggregatorSearchAttribute</name>
			<className>org.kuali.rice.kew.docsearch.xml.StandardGenericXMLSearchableAttribute</className>
			<label>AggregatorSearchAttribute</label>
			<description>AggregatorSearchAttribute</description>
			<type>SearchableXmlAttribute</type>
			<serviceNamespace>KC</serviceNamespace>
			<searchingConfig>
				<fieldDef name="aggregator" title="Aggregator">
					<display>
						<type>text</type>
					</display>
					<lookup businessObjectClass="org.kuali.rice.kim.api.identity.Person">
				      <fieldConversions>
				        <fieldConversion lookupFieldName="principalName" localFieldName="aggregator"/>
				      </fieldConversions>
				    </lookup>
					
					<fieldEvaluation>
						<!-- not sure yet -->
						<!--  example //organization/organizationId -->
						<xpathexpression>
							//aggregator/string
						</xpathexpression>
					</fieldEvaluation>
				</fieldDef>
				<xmlSearchContent>
					<users>
						<aggregator>
							<value>%aggregator%</value>
						</aggregator>
					</users>
				</xmlSearchContent>
			</searchingConfig>
		</ruleAttribute>
		<ruleAttribute>
			<name>BudgetCreatorSearchAttribute</name>
			<className>
				org.kuali.rice.kew.docsearch.xml.StandardGenericXMLSearchableAttribute
			</className>
			<label>BudgetCreatorSearchAttribute</label>
			<description>BudgetCreatorSearchAttribute</description>
			<type>SearchableXmlAttribute</type>
			<serviceNamespace>KC</serviceNamespace>
			<searchingConfig>
				<fieldDef name="budgetCreator" title="Budget Creator">
					<display>
						<type>text</type>
					</display>
					<lookup businessObjectClass="org.kuali.rice.kim.api.identity.Person">
				      <fieldConversions>
				        <fieldConversion lookupFieldName="principalName" localFieldName="budgetCreator"/>
				      </fieldConversions>
				    </lookup>
					
					<fieldEvaluation>
						<xpathexpression>
							//budgetcreator/string
						</xpathexpression>
					</fieldEvaluation>
				</fieldDef>
				<xmlSearchContent>
					<users>
						<budgetCreator>
							<value>%budgetCreator%</value>
						</budgetCreator>
					</users>
				</xmlSearchContent>
			</searchingConfig>
		</ruleAttribute>
		<ruleAttribute>
			<name>NarrativeWriterSearchAttribute</name>
			<className>org.kuali.rice.kew.docsearch.xml.StandardGenericXMLSearchableAttribute</className>
			<label>NarrativeWriterSearchAttribute</label>
			<description>NarrativeWriterSearchAttribute</description>
			<type>SearchableXmlAttribute</type>
			<serviceNamespace>KC</serviceNamespace>
			<searchingConfig>
				<fieldDef name="narrativeWriter"
					title="Narrative Writer">
					<display>
						<type>text</type>
					</display>
					<lookup businessObjectClass="org.kuali.rice.kim.api.identity.Person">
				      <fieldConversions>
				        <fieldConversion lookupFieldName="principalName" localFieldName="narrativeWriter"/>
				      </fieldConversions>
				    </lookup>
					
					<fieldEvaluation>
						<xpathexpression>
							//narrativewriter/string
						</xpathexpression>
					</fieldEvaluation>
				</fieldDef>
				<xmlSearchContent>
					<users>
						<narrativeWriter>
							<value>%narrativeWriter%</value>
						</narrativeWriter>
					</users>
				</xmlSearchContent>
			</searchingConfig>
		</ruleAttribute>
		<ruleAttribute>
			<name>ViewerSearchAttribute</name>
			<className>org.kuali.rice.kew.docsearch.xml.StandardGenericXMLSearchableAttribute</className>
			<label>ViewerSearchAttribute</label>
			<description>ViewerSearchAttribute</description>
			<type>SearchableXmlAttribute</type>
			<serviceNamespace>KC</serviceNamespace>
			<searchingConfig>
				<fieldDef name="viewer" title="Viewer">
					<display>
						<type>text</type>
					</display>
					<lookup businessObjectClass="org.kuali.rice.kim.api.identity.Person">
				      <fieldConversions>
				        <fieldConversion lookupFieldName="principalName" localFieldName="viewer"/>
				      </fieldConversions>
				    </lookup>
					
					<fieldEvaluation>
						<xpathexpression>
							//viewer/string
						</xpathexpression>
					</fieldEvaluation>
				</fieldDef>
				<xmlSearchContent>
					<users>
						<viewer>
							<value>%viewer%</value>
						</viewer>
					</users>
				</xmlSearchContent>
			</searchingConfig>
		</ruleAttribute>
		<ruleAttribute>
			<name>ProposalPersons-XPathQualifierResolver</name>
			<className>org.kuali.rice.kew.role.XPathQualifierResolver</className>
			<label>ProposalPersons-XPathQualifierResolver</label>
			<description>ProposalPersons-XPathQualifierResolver</description>
			<type>QualifierResolver</type>
			<serviceNamespace>KC</serviceNamespace>
			<resolverConfig>
				<attributes name="proposal">
					<xPathExpression>//document/developmentProposal/proposalNumber</xPathExpression>
				</attributes>
			</resolverConfig>
		</ruleAttribute>
		<ruleAttribute>
			<name>UH_Final_Approval-XPathQualifierResolver</name>
			<className>org.kuali.rice.kew.role.XPathQualifierResolver</className>
			<label>UH_Final_Approval-XPathQualifierResolver</label>
			<description>UH_Final_Approval-XPathQualifierResolver</description>
			<type>QualifierResolver</type>
			<serviceNamespace>KC</serviceNamespace>
			<resolverConfig>
				<attributes name="unitNumber">
					<xPathExpression>//document/developmentProposal/ownedByUnitNumber</xPathExpression>
				</attributes>
			</resolverConfig>
		</ruleAttribute>
	</ruleAttributes>
</data>
